values:
  type: kpi_analytics
  info: 'KPI Analytics: Posts created'
  uuid: b2b84dd7-a220-4837-8e14-aac24d677cf6
fields:
  field_kpi_datasource: drupal_kpi_datasource
  field_kpi_query: >
    SELECT created, count_cm, count_lu, count_sm FROM
    (
    	SELECT
    		FROM_UNIXTIME(pfd.created, '%Y-%m')  AS created,
    		COUNT(ur.entity_id) AS count_cm,
    		(COUNT(pfd.id) - COUNT(ur.entity_id) - COUNT(ur3.entity_id)) AS count_lu,
    		COUNT(ur3.entity_id) AS count_sm

    	FROM post_field_data pfd

    	LEFT OUTER JOIN user__roles ur ON ur.entity_id = pfd.user_id AND ur.roles_target_id = 'contentmanager'
    	LEFT OUTER JOIN user__roles ur2 ON ur2.entity_id = pfd.user_id AND ur2.roles_target_id NOT IN ('contentmanager', 'sitemanager')
    	LEFT OUTER JOIN user__roles ur3 ON ur3.entity_id = pfd.user_id AND ur3.roles_target_id = 'sitemanager'

    	WHERE FROM_UNIXTIME(pfd.created, '%Y-%m')
    		BETWEEN
    			FROM_UNIXTIME(UNIX_TIMESTAMP(DATE_SUB(CURDATE(), INTERVAL 2 MONTH)), '%Y-%m')
    		AND
    			FROM_UNIXTIME(UNIX_TIMESTAMP(CURDATE()), '%Y-%m')
    	GROUP BY FROM_UNIXTIME(pfd.created, '%Y-%m')
    ) AS source
    GROUP BY created, count_cm, count_lu, count_sm;
  field_kpi_data_formatter:
    -
      value: three_months_timeline_kpi_data_formatter
  field_kpi_visualization: morris_bar_graph_kpi_visualization
  field_kpi_chart_labels:
    -
      value: 'Posts by Community Managers'
    -
      value: 'Posts by Community'
    -
      value: 'Posts by Site Managers'
  field_kpi_chart_colors:
    -
      value: '#29abe2'
    -
      value: '#ffc142'
    -
      value: '#4caf50'
  body:
    -
      format: basic_html
      value: >
        Distinguish posts created by content managers and site managers versus posts created by the community (e.g. users without a special role in the community).
